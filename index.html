<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Health bot</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet"/>
<style>
  :root {
    --bg: #0a0f1e;
    --surface: #111827;
    --surface2: #1a2236;
    --border: #1f2f4a;
    --accent: #00d4a8;
    --accent2: #0088ff;
    --accent3: #7c3aed;
    --text: #e8f0fe;
    --text-muted: #6b7fa3;
    --user-bubble: #0f3460;
    --ai-bubble: #141f35;
    --red: #ff4f6a;
    --yellow: #f59e0b;
    --green: #10b981;
    --radius: 16px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Sora', sans-serif;
    background: var(--bg);
    color: var(--text);
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 80% 50% at 20% 10%, rgba(0,212,168,0.06) 0%, transparent 60%),
      radial-gradient(ellipse 60% 40% at 80% 80%, rgba(0,136,255,0.07) 0%, transparent 60%),
      radial-gradient(ellipse 50% 50% at 50% 50%, rgba(124,58,237,0.04) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 24px;
    border-bottom: 1px solid var(--border);
    background: rgba(17,24,39,0.8);
    backdrop-filter: blur(20px);
    position: relative;
    z-index: 10;
    flex-shrink: 0;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .logo-icon {
    width: 40px; height: 40px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
    box-shadow: 0 0 20px rgba(0,212,168,0.3);
  }

  .logo-text {
    display: flex; flex-direction: column;
  }

  .logo-text strong {
    font-family: 'DM Serif Display', serif;
    font-size: 18px;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1;
  }

  .logo-text span {
    font-size: 11px;
    color: var(--text-muted);
    letter-spacing: 0.05em;
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .status-badge {
    display: flex; align-items: center; gap: 6px;
    padding: 6px 12px;
    background: rgba(16,185,129,0.1);
    border: 1px solid rgba(16,185,129,0.2);
    border-radius: 20px;
    font-size: 12px;
    color: var(--green);
  }

  .status-dot {
    width: 7px; height: 7px;
    background: var(--green);
    border-radius: 50%;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(0.8); }
  }

  .btn-clear {
    padding: 7px 14px;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text-muted);
    font-size: 12px;
    font-family: 'Sora', sans-serif;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-clear:hover {
    border-color: var(--red);
    color: var(--red);
  }

  .main {
    display: flex;
    flex: 1;
    overflow: hidden;
    position: relative;
    z-index: 1;
  }

  .sidebar {
    width: 280px;
    flex-shrink: 0;
    background: rgba(17,24,39,0.6);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    padding: 20px 16px;
    gap: 20px;
  }

  .sidebar-section h4 {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--text-muted);
    margin-bottom: 10px;
    font-weight: 600;
  }

  .quick-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
    padding: 10px 12px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--text);
    font-size: 13px;
    font-family: 'Sora', sans-serif;
    cursor: pointer;
    text-align: left;
    transition: all 0.2s;
    margin-bottom: 6px;
  }

  .quick-btn:hover {
    border-color: var(--accent);
    background: rgba(0,212,168,0.05);
    color: var(--accent);
    transform: translateX(3px);
  }

  .quick-btn .icon { font-size: 16px; }

  .checker-panel {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px;
  }

  .checker-panel h4 {
    font-size: 13px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 10px;
    display: flex; align-items: center; gap: 6px;
  }

  .form-group { margin-bottom: 10px; }

  .form-group label {
    font-size: 11px;
    color: var(--text-muted);
    display: block;
    margin-bottom: 4px;
  }

  .form-control {
    width: 100%;
    padding: 8px 10px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'Sora', sans-serif;
    font-size: 12px;
    outline: none;
    transition: border-color 0.2s;
  }

  .form-control:focus { border-color: var(--accent); }
  .form-control option { background: var(--surface); }

  .btn-analyze {
    width: 100%;
    padding: 9px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border: none;
    border-radius: 8px;
    color: #000;
    font-family: 'Sora', sans-serif;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    margin-top: 4px;
  }

  .btn-analyze:hover { opacity: 0.9; transform: translateY(-1px); }
  .btn-analyze:disabled { opacity: 0.5; cursor: not-allowed; }

  .risk-result {
    margin-top: 10px;
    padding: 10px;
    background: var(--bg);
    border-radius: 8px;
    font-size: 12px;
    display: none;
    animation: fadeIn 0.3s ease;
  }

  .risk-result p { margin-bottom: 4px; line-height: 1.5; }

  .risk-emergency { color: var(--red); font-weight: 600; }
  .risk-warning { color: var(--yellow); font-weight: 600; }
  .risk-safe { color: var(--green); font-weight: 600; }

  .disclaimer {
    font-size: 10px;
    color: var(--text-muted);
    background: rgba(245,158,11,0.05);
    border: 1px solid rgba(245,158,11,0.15);
    border-radius: 8px;
    padding: 8px 10px;
    line-height: 1.5;
  }

  .chat-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 24px 28px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    scroll-behavior: smooth;
  }

  .chat-messages::-webkit-scrollbar { width: 4px; }
  .chat-messages::-webkit-scrollbar-track { background: transparent; }
  .chat-messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

  .welcome {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px;
    text-align: center;
    animation: fadeIn 0.6s ease;
  }

  .welcome-icon {
    width: 80px; height: 80px;
    background: linear-gradient(135deg, rgba(0,212,168,0.15), rgba(0,136,255,0.15));
    border: 1px solid rgba(0,212,168,0.2);
    border-radius: 24px;
    display: flex; align-items: center; justify-content: center;
    font-size: 40px;
    margin-bottom: 20px;
    box-shadow: 0 0 40px rgba(0,212,168,0.1);
  }

  .welcome h2 {
    font-family: 'DM Serif Display', serif;
    font-size: 28px;
    background: linear-gradient(135deg, var(--text), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 10px;
  }

  .welcome p {
    color: var(--text-muted);
    font-size: 14px;
    max-width: 400px;
    line-height: 1.7;
    margin-bottom: 24px;
  }

  .welcome-chips {
    display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
  }

  .chip {
    padding: 8px 16px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 20px;
    font-size: 12px;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.2s;
  }

  .chip:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(0,212,168,0.05);
  }

  .message-row {
    display: flex;
    gap: 12px;
    animation: slideUp 0.3s ease;
  }

  .message-row.user { flex-direction: row-reverse; }

  @keyframes slideUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .avatar {
    width: 34px; height: 34px;
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px;
    flex-shrink: 0;
    margin-top: 2px;
  }

  .avatar.ai {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    box-shadow: 0 0 12px rgba(0,212,168,0.3);
  }

  .avatar.user {
    background: var(--user-bubble);
    border: 1px solid var(--border);
  }

  .bubble {
    max-width: 68%;
    padding: 13px 16px;
    border-radius: 14px;
    font-size: 14px;
    line-height: 1.65;
  }

  .bubble.ai {
    background: var(--ai-bubble);
    border: 1px solid var(--border);
    border-top-left-radius: 4px;
    color: var(--text);
  }

  .bubble.user {
    background: var(--user-bubble);
    border: 1px solid rgba(0,136,255,0.2);
    border-top-right-radius: 4px;
    color: var(--text);
  }

  .bubble a { color: var(--accent); }

  .bubble .tag {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    margin-bottom: 6px;
  }

  .tag.emergency { background: rgba(255,79,106,0.15); color: var(--red); border: 1px solid rgba(255,79,106,0.3); }
  .tag.warning { background: rgba(245,158,11,0.15); color: var(--yellow); border: 1px solid rgba(245,158,11,0.3); }
  .tag.info { background: rgba(0,212,168,0.1); color: var(--accent); border: 1px solid rgba(0,212,168,0.2); }
  .tag.greeting { background: rgba(124,58,237,0.1); color: #a78bfa; border: 1px solid rgba(124,58,237,0.3); }

  .msg-time {
    font-size: 10px;
    color: var(--text-muted);
    margin-top: 4px;
    padding: 0 4px;
  }

  .typing-indicator {
    display: flex; align-items: center; gap: 5px;
    padding: 14px 16px;
  }

  .typing-dot {
    width: 7px; height: 7px;
    background: var(--accent);
    border-radius: 50%;
    animation: typing 1.2s infinite;
  }

  .typing-dot:nth-child(2) { animation-delay: 0.2s; }
  .typing-dot:nth-child(3) { animation-delay: 0.4s; }

  @keyframes typing {
    0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
    30% { transform: translateY(-6px); opacity: 1; }
  }

  .input-area {
    padding: 16px 24px 20px;
    border-top: 1px solid var(--border);
    background: rgba(17,24,39,0.8);
    backdrop-filter: blur(20px);
    flex-shrink: 0;
  }

  .input-row {
    display: flex;
    gap: 10px;
    align-items: flex-end;
    max-width: 800px;
    margin: 0 auto;
  }

  .input-wrapper {
    flex: 1;
    position: relative;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 14px;
    transition: border-color 0.2s;
  }

  .input-wrapper:focus-within {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(0,212,168,0.08);
  }

  #chatInput {
    width: 100%;
    background: transparent;
    border: none;
    outline: none;
    color: var(--text);
    font-family: 'Sora', sans-serif;
    font-size: 14px;
    padding: 13px 16px;
    resize: none;
    max-height: 140px;
    line-height: 1.5;
  }

  #chatInput::placeholder { color: var(--text-muted); }

  .input-hint {
    font-size: 11px;
    color: var(--text-muted);
    text-align: center;
    margin-top: 8px;
  }

  .send-btn {
    width: 46px; height: 46px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border: none;
    border-radius: 12px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    transition: all 0.2s;
    flex-shrink: 0;
    box-shadow: 0 4px 15px rgba(0,212,168,0.25);
  }

  .send-btn:hover { transform: scale(1.05); box-shadow: 0 6px 20px rgba(0,212,168,0.35); }
  .send-btn:active { transform: scale(0.97); }
  .send-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  /* Detected symptom highlight badge */
  .detected-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 3px 10px;
    background: rgba(0,212,168,0.1);
    border: 1px solid rgba(0,212,168,0.25);
    border-radius: 20px;
    font-size: 11px;
    color: var(--accent);
    margin-right: 5px;
    margin-bottom: 4px;
  }

  .detected-section {
    margin-bottom: 10px;
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    align-items: center;
  }

  .detected-label {
    font-size: 11px;
    color: var(--text-muted);
    margin-right: 4px;
  }

  @media (max-width: 768px) {
    .sidebar { display: none; }
    .chat-messages { padding: 16px; }
    .bubble { max-width: 85%; }
  }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="logo">
    <div class="logo-icon">‚öïÔ∏è</div>
    <div class="logo-text">
      <strong>Health bot</strong>
      <span>Health Assistant</span>
    </div>
  </div>
  <div class="header-right">
    <div class="status-badge">
      <div class="status-dot"></div>
      AI Online
    </div>
    <button class="btn-clear" onclick="clearChat()">Clear Chat</button>
  </div>
</div>

<!-- Main -->
<div class="main">

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-section">
      <h4>Quick Topics</h4>
      <button class="quick-btn" onclick="sendQuick('What are symptoms of high blood pressure?')">
        <span class="icon">‚ù§Ô∏è</span> Blood Pressure
      </button>
      <button class="quick-btn" onclick="sendQuick('How do I manage diabetes?')">
        <span class="icon">ü©∏</span> Diabetes
      </button>
      <button class="quick-btn" onclick="sendQuick('What causes persistent headaches?')">
        <span class="icon">üß†</span> Headaches
      </button>
      <button class="quick-btn" onclick="sendQuick('Tips for better sleep and mental health')">
        <span class="icon">üò¥</span> Sleep & Mental Health
      </button>
      <button class="quick-btn" onclick="sendQuick('How to boost my immune system naturally?')">
        <span class="icon">üõ°Ô∏è</span> Immunity
      </button>
      <button class="quick-btn" onclick="sendQuick('What are signs of dehydration?')">
        <span class="icon">üíß</span> Dehydration
      </button>
      <button class="quick-btn" onclick="sendQuick('Healthy diet and nutrition tips')">
        <span class="icon">ü•ó</span> Nutrition
      </button>
      <button class="quick-btn" onclick="sendQuick('What vaccinations do adults need?')">
        <span class="icon">üíâ</span> Vaccines
      </button>
    </div>

    <!-- Symptom Checker -->
    <div class="sidebar-section">
      <h4>Quick Symptom Check</h4>
      <div class="checker-panel">
        <div class="form-group">
          <label>Main Symptom</label>
          <input class="form-control" id="sc-symptom" placeholder="e.g. chest pain, fever‚Ä¶"/>
        </div>
        <div class="form-group">
          <label>Severity</label>
          <select class="form-control" id="sc-severity">
            <option value="">Select‚Ä¶</option>
            <option>Mild</option>
            <option>Moderate</option>
            <option>Severe</option>
          </select>
        </div>
        <div class="form-group">
          <label>Duration</label>
          <select class="form-control" id="sc-duration">
            <option value="">Select‚Ä¶</option>
            <option>Less than 1 day</option>
            <option>1‚Äì3 days</option>
            <option>4‚Äì7 days</option>
            <option>More than 1 week</option>
          </select>
        </div>
        <button class="btn-analyze" id="analyzeBtn" onclick="analyzeSymptom()">Analyze Symptom</button>
        <div class="risk-result" id="risk-result"></div>
      </div>
    </div>

    <div class="disclaimer">
      ‚ö†Ô∏è Health bot provides general health information only. It is not a substitute for professional medical advice, diagnosis, or treatment. Always consult a qualified healthcare provider.
    </div>
  </div>

  <!-- Chat area -->
  <div class="chat-area">
    <div class="chat-messages" id="chatMessages">
      <div class="welcome" id="welcomeScreen">
        <div class="welcome-icon">ü©∫</div>
        <h2>Your AI Health Companion</h2>
        <p>Ask me anything about symptoms, medications, wellness, nutrition, or general health. You can even just describe how you feel in a sentence ‚Äî I'll detect the symptoms automatically!</p>
        <div class="welcome-chips">
          <div class="chip" onclick="sendQuick('Hi, I have a fever and sore throat, what should I do?')">ü§í Fever & sore throat</div>
          <div class="chip" onclick="sendQuick('What are common signs of anxiety?')">üò∞ Signs of anxiety</div>
          <div class="chip" onclick="sendQuick('How much water should I drink daily?')">üíß Daily water intake</div>
          <div class="chip" onclick="sendQuick('What is asthma?')">ü´Å Asthma information</div>
          <div class="chip" onclick="sendQuick('Tell me about COVID-19')">ü¶† COVID-19</div>
          <div class="chip" onclick="sendQuick('What is hypertension?')">‚ù§Ô∏è Hypertension</div>
        </div>
      </div>
    </div>

    <div class="input-area">
      <div class="input-row">
        <div class="input-wrapper">
          <textarea id="chatInput" rows="1" placeholder="Describe how you feel, ask about symptoms, diseases‚Ä¶ I understand natural sentences!" onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
        </div>
        <button class="send-btn" id="sendBtn" onclick="sendMessage()">‚û§</button>
      </div>
      <div class="input-hint">Press Enter to send ¬∑ Shift+Enter for new line ¬∑ I understand natural conversation!</div>
    </div>
  </div>

</div>

<script>
  // ‚îÄ‚îÄ‚îÄ GREETING & GRATITUDE PATTERNS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const greetingPatterns = [
    /^(hi|hello|hey|howdy|greetings|good\s*(morning|afternoon|evening|day)|what'?s\s*up|sup|yo|hiya|salut|bonjour|hola)\b/i,
    /^(hi+|hey+|helo|helo+)\b/i
  ];

  const gratitudePatterns = [
    /\b(thank(s| you)|thx|ty|much appreciated|appreciate it|cheers|gracias|merci|danke|grazie|obrigado|arigato)\b/i
  ];

  const farewellPatterns = [
    /\b(bye|goodbye|see you|see ya|take care|farewell|ciao|adios|later|gotta go|ttyl)\b/i
  ];

  const howAreYouPatterns = [
    /\b(how are you|how('?re| are) you doing|how do you feel|are you ok|you alright|you okay)\b/i
  ];

  // ‚îÄ‚îÄ‚îÄ GREETING RESPONSES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function getGreetingResponse() {
    const hour = new Date().getHours();
    let timeGreeting = 'Hello';
    if (hour >= 5 && hour < 12) timeGreeting = 'Good morning';
    else if (hour >= 12 && hour < 17) timeGreeting = 'Good afternoon';
    else if (hour >= 17 && hour < 21) timeGreeting = 'Good evening';
    else timeGreeting = 'Hello';

    const responses = [
      `[GREETING]\n${timeGreeting}! üëã I'm your Health Bot, here to help you with any health questions or concerns. You can:\n\n‚Ä¢ **Describe your symptoms** in plain sentences ‚Äî I'll detect them automatically\n‚Ä¢ **Ask about diseases**, medications, or health topics\n‚Ä¢ **Use the symptom checker** on the sidebar for a quick assessment\n\nHow can I help you today?`,
      `[GREETING]\n${timeGreeting}! üòä Great to see you! I'm your AI health companion. Feel free to describe how you're feeling in your own words ‚Äî I'll understand and help you out. What's on your mind?`,
      `[GREETING]\n${timeGreeting}! ü©∫ Welcome! I'm here to answer your health questions. Whether you have specific symptoms or just want general health advice, just ask! How are you feeling today?`
    ];
    return responses[Math.floor(Math.random() * responses.length)];
  }

  function getGratitudeResponse() {
    const responses = [
      `[GREETING]\nYou're very welcome! üòä I'm always here if you have more questions or need health guidance. Take care of yourself!`,
      `[GREETING]\nHappy to help! üåø Your health is important. Don't hesitate to reach out anytime you have concerns or questions.`,
      `[GREETING]\nOf course! üíö That's what I'm here for. Stay healthy, and feel free to ask anything anytime!`,
      `[GREETING]\nMy pleasure! ü©∫ Looking after your wellbeing is my priority. Take care and stay well!`
    ];
    return responses[Math.floor(Math.random() * responses.length)];
  }

  function getFarewellResponse() {
    const responses = [
      `[GREETING]\nTake care! üëã Remember, if any symptoms persist or worsen, don't hesitate to see a healthcare professional. Stay healthy!`,
      `[GREETING]\nGoodbye! üåü Wishing you good health. Come back anytime you need health guidance!`,
      `[GREETING]\nFarewell! üíö Stay healthy and take care of yourself. I'm here whenever you need me!`
    ];
    return responses[Math.floor(Math.random() * responses.length)];
  }

  function getHowAreYouResponse() {
    return `[GREETING]\nThank you for asking! üòä I'm a health assistant AI, always ready and here to help you. More importantly ‚Äî how are **you** feeling? If you have any symptoms or health concerns, please share them and I'll do my best to help!`;
  }

  // ‚îÄ‚îÄ‚îÄ SYMPTOM DETECTION ENGINE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // Maps symptom keywords to topic keys in healthKnowledge
  const symptomMap = [
    { keywords: ['fever', 'temperature', 'feverish', 'running a fever', 'hot', 'feel hot', 'burning up', 'chills', 'shivering'], topic: 'fever' },
    { keywords: ['sore throat', 'throat pain', 'throat hurts', 'painful throat', 'swallowing hurts', 'hard to swallow', 'strep', 'tonsil'], topic: 'sore throat' },
    { keywords: ['headache', 'head pain', 'head hurts', 'head is pounding', 'my head', 'migraine', 'head ache', 'throbbing head', 'head is splitting'], topic: 'headache' },
    { keywords: ['anxious', 'anxiety', 'panic', 'panicking', 'nervous', 'worry', 'worried', 'constant worry', 'overthinking', 'can\'t relax', 'racing thoughts', 'heart racing', 'heart pounding'], topic: 'anxiety' },
    { keywords: ['depressed', 'depression', 'sad', 'hopeless', 'empty', 'no motivation', 'no energy', 'worthless', 'crying', 'cry a lot', 'can\'t get out of bed', 'suicidal', 'self harm'], topic: 'depression' },
    { keywords: ['blood pressure', 'hypertension', 'high pressure', 'bp is high', 'bp elevated'], topic: 'blood pressure' },
    { keywords: ['diabetic', 'diabetes', 'blood sugar', 'glucose', 'insulin', 'sugar level'], topic: 'diabetes' },
    { keywords: ['dehydrated', 'dehydration', 'very thirsty', 'dry mouth', 'dry lips', 'not drinking enough', 'dark urine', 'dizziness', 'dizzy', 'lightheaded'], topic: 'dehydration' },
    { keywords: ['sleep', 'insomnia', "can't sleep", 'not sleeping', 'poor sleep', 'trouble sleeping', 'sleepless', 'up all night', 'restless at night', 'waking up at night', 'tired all the time', 'always tired', 'exhausted', 'fatigue'], topic: 'sleep' },
    { keywords: ['stress', 'stressed', 'overwhelmed', 'burnout', 'burnt out', 'can\'t cope', 'too much pressure', 'anxious about work', 'tense', 'tension'], topic: 'stress' },
    { keywords: ['vaccine', 'vaccination', 'shot', 'booster', 'immunize', 'immunization'], topic: 'vaccin' },
    { keywords: ['water intake', 'drink water', 'hydration', 'how much water', 'need to drink more'], topic: 'water' },
    { keywords: ['nutrition', 'diet', 'eating healthy', 'healthy food', 'what to eat', 'healthy eating', 'balanced diet', 'food habits'], topic: 'nutrition' },
    { keywords: ['nausea', 'nauseous', 'feel like vomiting', 'feel like throwing up', 'vomit', 'threw up', 'sick to my stomach', 'stomach ache', 'stomach pain', 'abdominal pain', 'belly pain', 'cramping'], topic: 'stomach' },
    { keywords: ['cough', 'coughing', 'dry cough', 'wet cough', 'can\'t stop coughing', 'chest cough', 'coughing up'], topic: 'cough' },
    { keywords: ['rash', 'skin rash', 'itching', 'itchy skin', 'hives', 'red spots', 'skin irritation', 'bumps on skin'], topic: 'rash' },
    { keywords: ['chest pain', 'chest tightness', 'chest pressure', 'heart pain', 'chest hurts', 'left arm pain', 'shortness of breath', 'can\'t breathe', 'difficulty breathing', 'breathing trouble', 'breathless'], topic: 'chest' },
    { keywords: ['cold', 'runny nose', 'stuffy nose', 'blocked nose', 'nasal congestion', 'sneezing', 'common cold', 'flu', 'influenza', 'body aches', 'body pain', 'muscle aches'], topic: 'cold' },
    { keywords: ['back pain', 'backache', 'lower back', 'back hurts', 'spinal pain', 'spine'], topic: 'back pain' },
    { keywords: ['joint pain', 'arthritis', 'knee pain', 'hip pain', 'swollen joints', 'stiff joints', 'rheumatism'], topic: 'joint pain' },
  ];

  // Detect multiple symptoms in a sentence
  function detectSymptoms(msg) {
    const lower = msg.toLowerCase();
    const detected = [];
    const seenTopics = new Set();

    for (const entry of symptomMap) {
      for (const kw of entry.keywords) {
        if (lower.includes(kw) && !seenTopics.has(entry.topic)) {
          detected.push({ keyword: kw, topic: entry.topic });
          seenTopics.add(entry.topic);
          break;
        }
      }
    }
    return detected;
  }

  // ‚îÄ‚îÄ‚îÄ HEALTH KNOWLEDGE BASE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const healthKnowledge = {
    'vaccin': {
      keywords: ['vaccin', 'vaccine', 'vaccination', 'immunize', 'shot', 'booster'],
      response: '[INFO]\nVaccinations are one of the most effective ways to prevent serious diseases.\n\n**Recommended Adult Vaccines:**\n‚Ä¢ **COVID-19:** Updated boosters annually\n‚Ä¢ **Flu (Influenza):** Annual vaccine recommended for all adults\n‚Ä¢ **Tdap:** Protects against tetanus, diphtheria, pertussis\n‚Ä¢ **MMR:** Measles, mumps, rubella\n‚Ä¢ **Varicella:** Chickenpox (if never had it)\n‚Ä¢ **Shingles (Zoster):** Two doses for adults 50+\n‚Ä¢ **Pneumococcal:** Recommended for 65+\n‚Ä¢ **Hepatitis A & B:** For those at risk\n‚Ä¢ **HPV:** Up to age 45\n‚Ä¢ **Meningococcal:** For certain age groups\n\n**Why Vaccines Matter:**\n‚Ä¢ Prevent serious, sometimes life-threatening diseases\n‚Ä¢ Protect vulnerable people around you\n‚Ä¢ Have strong safety records\n\n**Side Effects:**\nMost are mild (sore arm, low fever). Serious reactions are very rare.\n\nTalk to your doctor about your specific vaccine needs based on age, health, and travel plans.'
    },

    'fever': {
      response: '[INFO]\nA fever is usually your body\'s way of fighting an infection.\n\n**When to monitor at home:**\nFever under 103¬∞F (39.4¬∞C) ‚Äî stay hydrated, rest, and use over-the-counter fever reducers like acetaminophen or ibuprofen.\n\n**When to seek care immediately:**\n‚Ä¢ Fever over 104¬∞F (40¬∞C)\n‚Ä¢ Lasts more than 3‚Äì5 days\n‚Ä¢ Accompanied by difficulty breathing, chest pain, or severe headache\n‚Ä¢ Seizures or confusion\n\n**Home care tips:**\n‚Ä¢ Drink plenty of water and electrolyte solutions\n‚Ä¢ Rest as much as possible\n‚Ä¢ Apply a cool (not cold) damp cloth to the forehead\n‚Ä¢ Wear light, breathable clothing\n\nIf symptoms persist or worsen, please consult a healthcare professional.'
    },

    'sore throat': {
      response: '[INFO]\nA sore throat is commonly caused by viral or bacterial infections.\n\n**Possible causes:**\nMost sore throats are viral (colds, flu). Some are bacterial (strep throat) and may require antibiotics.\n\n**Home remedies:**\n‚Ä¢ Gargle with warm salt water (¬Ω tsp salt in 8 oz warm water)\n‚Ä¢ Drink warm tea with honey and lemon\n‚Ä¢ Use throat lozenges\n‚Ä¢ Take ibuprofen or acetaminophen for pain\n‚Ä¢ Stay well-hydrated and rest\n\n**See a doctor if:**\n‚Ä¢ You have severe pain or difficulty swallowing\n‚Ä¢ High fever above 101¬∞F\n‚Ä¢ White patches on the back of your throat\n‚Ä¢ Symptoms lasting more than a week\n\nViral sore throats typically resolve within 7‚Äì10 days with rest and hydration.'
    },

    'headache': {
      response: '[INFO]\nHeadaches are very common and usually manageable at home.\n\n**Immediate relief:**\n‚Ä¢ Rest in a quiet, dark room\n‚Ä¢ Apply a cold or warm compress to your forehead or neck\n‚Ä¢ Drink water ‚Äî dehydration is a very common trigger\n‚Ä¢ Take over-the-counter pain relievers (ibuprofen, acetaminophen)\n\n**Common triggers:**\nDehydration, stress, poor sleep, caffeine withdrawal, tension, skipped meals, bright lights, loud noise.\n\n**Seek urgent care if:**\n‚Ä¢ Headache is sudden and severe ("thunderclap")\n‚Ä¢ Accompanied by fever, stiff neck, vision changes, or confusion\n‚Ä¢ Worst headache of your life\n‚Ä¢ Following a head injury\n\n**Prevention:**\nRegular exercise, consistent sleep, stress management, and staying hydrated prevent many headaches.\n\nIf headaches are frequent or getting worse over time, consult your doctor.'
    },

    'anxiety': {
      response: '[INFO]\nAnxiety is a common and very manageable condition.\n\n**Physical symptoms:**\nRapid heartbeat, sweating, trembling, difficulty breathing, chest tightness, and restlessness.\n\n**Immediate coping techniques:**\n‚Ä¢ **4-7-8 breathing:** Inhale 4 counts, hold 7, exhale 8\n‚Ä¢ **Grounding (5-4-3-2-1):** Name 5 things you see, 4 you can touch, 3 you hear, 2 you smell, 1 you taste\n‚Ä¢ **Progressive muscle relaxation:** Tense and release each muscle group\n‚Ä¢ **Move:** A short walk or light exercise quickly reduces anxiety\n\n**Long-term management:**\n‚Ä¢ Regular exercise\n‚Ä¢ Meditation or mindfulness practice\n‚Ä¢ Limit caffeine and alcohol\n‚Ä¢ Consistent sleep schedule\n‚Ä¢ Talk therapy (CBT is very effective)\n\nIf anxiety is significantly affecting your daily life, seeing a mental health professional can be life-changing ‚Äî it\'s a sign of strength, not weakness.'
    },

    'depression': {
      response: '[INFO]\nDepression is a serious but very treatable condition.\n\n**Common symptoms:**\nPersistent sadness, loss of interest in things you used to enjoy, sleep changes, fatigue, difficulty concentrating, or feelings of hopelessness.\n\n**What helps:**\n‚Ä¢ Talk to a therapist or counselor\n‚Ä¢ Regular exercise (proven to improve mood significantly)\n‚Ä¢ Maintain social connections even when it\'s hard\n‚Ä¢ Sleep and eat regularly\n‚Ä¢ Limit alcohol\n‚Ä¢ Spend time in nature\n\n**Professional help:**\nTherapy (CBT, talk therapy) and medication (antidepressants) are both effective. A doctor can help find the best approach for you.\n\n**Crisis support ‚Äî please reach out:**\n‚Ä¢ **988 Suicide & Crisis Lifeline:** Call or text **988** (US)\n‚Ä¢ **Crisis Text Line:** Text HOME to **741741**\n‚Ä¢ Go to your nearest emergency room\n\nYou are not alone. Depression is treatable and seeking help is one of the bravest things you can do.'
    },

    'blood pressure': {
      response: '[INFO]\nHigh blood pressure (hypertension) often has no obvious symptoms but significantly increases health risks.\n\n**Symptoms (when very high):**\nHeadaches, shortness of breath, nosebleeds, chest discomfort, vision changes.\n\n**Management:**\n‚Ä¢ Regular exercise (at least 150 minutes/week of moderate activity)\n‚Ä¢ Reduce salt intake\n‚Ä¢ Maintain a healthy weight\n‚Ä¢ Limit alcohol\n‚Ä¢ Manage stress (meditation, yoga, deep breathing)\n‚Ä¢ Follow the DASH diet (fruits, vegetables, whole grains, low-fat dairy)\n‚Ä¢ Take prescribed medications consistently\n\n**Blood pressure numbers to know:**\n‚Ä¢ Normal: Below 120/80\n‚Ä¢ Elevated: 120‚Äì129/under 80\n‚Ä¢ High: 130/80 or above\n‚Ä¢ Crisis: 180/120+ (seek emergency care)\n\nConsult your doctor if readings are consistently above 140/90 or you experience symptoms like chest pain or vision changes.'
    },

    'diabetes': {
      response: '[INFO]\nDiabetes is a chronic but manageable condition affecting blood sugar levels.\n\n**Types:**\n‚Ä¢ **Type 1:** Autoimmune; requires insulin therapy\n‚Ä¢ **Type 2:** Insulin resistance; often managed with lifestyle and medication\n‚Ä¢ **Gestational:** During pregnancy\n\n**Warning symptoms:**\nIncreased thirst, frequent urination, fatigue, blurred vision, slow-healing wounds, numbness in hands/feet.\n\n**Management:**\n‚Ä¢ Monitor blood sugar regularly\n‚Ä¢ Eat a balanced diet low in refined sugars and processed carbs\n‚Ä¢ Exercise regularly ‚Äî it helps control blood sugar directly\n‚Ä¢ Take medications or insulin as prescribed\n‚Ä¢ Maintain a healthy weight\n‚Ä¢ Regular doctor check-ups (A1C, kidney function, eye exams)\n‚Ä¢ Manage stress\n\n**Complications to prevent:**\nHeart disease, kidney disease, nerve damage, and vision problems. Good control prevents these.\n\nWith proper management, people with diabetes live full, healthy lives.'
    },

    'dehydration': {
      response: '[INFO]\nDehydration can range from mild to life-threatening.\n\n**Common symptoms:**\nThirst, dark or strong-smelling urine, dizziness, fatigue, dry mouth/lips, headache, reduced urination.\n\n**How to rehydrate:**\n‚Ä¢ Sip water gradually ‚Äî don\'t gulp large amounts at once\n‚Ä¢ Electrolyte drinks (sports drinks, coconut water, oral rehydration salts) help if vomiting or diarrhea\n‚Ä¢ Eat water-rich foods: watermelon, cucumber, oranges\n‚Ä¢ Avoid caffeine and alcohol temporarily\n\n**Daily prevention:**\n‚Ä¢ About 8 glasses (2 liters) of water daily; more if exercising or in hot weather\n‚Ä¢ Drink before you feel thirsty\n‚Ä¢ Light-colored urine = good hydration; dark = drink more\n\n**Seek medical care if:**\n‚Ä¢ No urination for 8+ hours\n‚Ä¢ Extreme dizziness or confusion\n‚Ä¢ Rapid heartbeat\n‚Ä¢ Vomiting preventing fluid intake\n‚Ä¢ Very young children or elderly with severe symptoms'
    },

    'water': {
      response: '[INFO]\nProper hydration is one of the simplest and most impactful health habits.\n\n**Daily recommendations:**\n‚Ä¢ **Men:** About 15.5 cups (3.7 liters) per day\n‚Ä¢ **Women:** About 11.5 cups (2.7 liters) per day\n‚Ä¢ Adjust for exercise, hot weather, pregnancy, or illness\n\n**Signs of good hydration:**\n‚Ä¢ Light-colored, pale yellow urine\n‚Ä¢ Good energy levels\n‚Ä¢ Clear-headed thinking\n‚Ä¢ Healthy skin\n\n**Best hydration sources:**\n‚Ä¢ Water (best choice)\n‚Ä¢ Herbal teas (no caffeine)\n‚Ä¢ Fruits and vegetables\n‚Ä¢ Limit sugary drinks and excessive caffeine\n\n**Easy tips to drink more:**\n‚Ä¢ Keep a water bottle with you\n‚Ä¢ Drink a glass before each meal\n‚Ä¢ Set reminders on your phone\n‚Ä¢ Add fruit slices to water for flavor\n\nProper hydration supports energy, digestion, brain function, and skin health.'
    },

    'nutrition': {
      response: '[INFO]\nGood nutrition is the foundation of long-term health.\n\n**Food groups to prioritize:**\n‚Ä¢ **Fruits & vegetables:** 5+ servings daily; eat a variety of colors\n‚Ä¢ **Whole grains:** Brown rice, oats, whole wheat bread, quinoa\n‚Ä¢ **Lean protein:** Fish, chicken, beans, lentils, eggs, nuts\n‚Ä¢ **Healthy fats:** Olive oil, avocado, nuts, fatty fish (omega-3s)\n‚Ä¢ **Dairy/alternatives:** Low-fat milk, yogurt, or plant-based options\n\n**Core principles:**\n‚Ä¢ Choose whole, unprocessed foods over packaged foods\n‚Ä¢ Control portions; eat slowly and mindfully\n‚Ä¢ Limit added sugar, salt, and unhealthy fats\n‚Ä¢ Never skip meals ‚Äî especially breakfast\n‚Ä¢ Drink water, not sugary drinks\n\n**Heart-healthy superfoods:**\nSalmon, berries, leafy greens, nuts, olive oil, oats, beans, and dark chocolate (in moderation).\n\nFor a personalized nutrition plan, a registered dietitian can be incredibly helpful.'
    },

    'sleep': {
      response: '[INFO]\nQuality sleep is one of the most important pillars of health.\n\n**Sleep needs:**\nAdults need 7‚Äì9 hours per night. Consistency matters as much as duration.\n\n**Sleep hygiene tips:**\n‚Ä¢ Keep your bedroom dark, quiet, and cool (around 65‚Äì68¬∞F / 18‚Äì20¬∞C)\n‚Ä¢ Go to bed and wake at the same time every day ‚Äî even on weekends\n‚Ä¢ Avoid screens 30‚Äì60 minutes before bed (blue light disrupts melatonin)\n‚Ä¢ Limit caffeine after 2 PM\n‚Ä¢ Avoid large meals or alcohol close to bedtime\n‚Ä¢ Exercise regularly ‚Äî but not right before bed\n\n**Wind-down routine:**\nTry reading, light stretching, meditation, or a warm bath to signal your body it\'s time to sleep.\n\n**Can\'t fall asleep?**\nGet up and do something calm in low light. Return to bed only when drowsy.\n\n**See a doctor if:**\nYou have chronic insomnia, loud snoring, sleep apnea, or excessive daytime sleepiness.'
    },

    'stress': {
      response: '[INFO]\nChronic stress affects your mind, body, and immune system. Here are proven strategies:\n\n**Quick relief (1‚Äì5 minutes):**\n‚Ä¢ Deep slow breaths ‚Äî activates your parasympathetic system\n‚Ä¢ Tense and release muscle groups (progressive relaxation)\n‚Ä¢ Take a short walk outside\n‚Ä¢ Splash cold water on your face\n\n**Daily practices:**\n‚Ä¢ **Meditation:** Even 5‚Äì10 minutes daily makes a difference\n‚Ä¢ **Yoga:** Combines movement, breathing, and mindfulness\n‚Ä¢ **Exercise:** One of the most powerful stress relievers\n‚Ä¢ **Journaling:** Write out thoughts and worries to clear your mind\n\n**Lifestyle habits:**\n‚Ä¢ Set healthy boundaries ‚Äî learn to say no\n‚Ä¢ Prioritize tasks; not everything is urgent\n‚Ä¢ Maintain social connections\n‚Ä¢ Get adequate sleep (stress and sleep deprivation feed each other)\n‚Ä¢ Limit caffeine and alcohol\n\n**When to seek help:**\nIf stress is overwhelming or constant, a therapist or counselor can provide powerful tools. It is a sign of self-awareness, not weakness.'
    },

    'stomach': {
      response: '[INFO]\nStomach pain and nausea are among the most common health complaints.\n\n**Possible causes:**\nIndigestion, food poisoning, gastroenteritis (stomach flu), acid reflux, constipation, or stress.\n\n**Home remedies for nausea:**\n‚Ä¢ Ginger tea or ginger chews ‚Äî very effective for nausea\n‚Ä¢ Eat bland foods (BRAT diet: Banana, Rice, Applesauce, Toast)\n‚Ä¢ Sip clear fluids ‚Äî broth, water, herbal tea\n‚Ä¢ Avoid greasy, spicy, or heavy foods\n‚Ä¢ Rest in a semi-upright position\n‚Ä¢ Peppermint tea may help ease discomfort\n\n**Seek medical care if:**\n‚Ä¢ Severe or sudden abdominal pain\n‚Ä¢ Blood in vomit or stool\n‚Ä¢ Vomiting that lasts more than 24 hours\n‚Ä¢ Signs of dehydration\n‚Ä¢ High fever with stomach pain\n‚Ä¢ Pain in the lower right abdomen (possible appendicitis)'
    },

    'cough': {
      response: '[INFO]\nA cough is your body\'s way of clearing the airway. It can have many causes.\n\n**Common causes:**\nViral infections (cold, flu, COVID-19), allergies, asthma, acid reflux, or irritants.\n\n**Home care:**\n‚Ä¢ Stay well-hydrated ‚Äî fluids loosen mucus\n‚Ä¢ Honey (1‚Äì2 tsp) has proven cough-soothing effects\n‚Ä¢ Steam inhalation helps with congestion\n‚Ä¢ Use a humidifier in dry environments\n‚Ä¢ Elevate your head when sleeping\n‚Ä¢ Avoid smoking or secondhand smoke\n\n**Types to know:**\n‚Ä¢ **Dry cough:** Often viral or allergy-related\n‚Ä¢ **Productive cough (with mucus):** May be infection or bronchitis\n‚Ä¢ **Barking cough:** Could be croup (in children)\n‚Ä¢ **Wheezing cough:** Could indicate asthma\n\n**See a doctor if:**\n‚Ä¢ Cough lasts more than 3 weeks\n‚Ä¢ You cough up blood\n‚Ä¢ Accompanied by chest pain or difficulty breathing\n‚Ä¢ High fever or significant fatigue'
    },

    'rash': {
      response: '[INFO]\nSkin rashes have many causes ‚Äî most are not serious but some require prompt attention.\n\n**Common causes:**\nAllergic reactions, contact dermatitis, eczema, heat rash, hives, viral infections (chickenpox, shingles), or insect bites.\n\n**Home care for mild rashes:**\n‚Ä¢ Apply cool, damp compresses\n‚Ä¢ Hydrocortisone cream (1%) reduces inflammation and itching\n‚Ä¢ Antihistamines help with allergic rashes and itching\n‚Ä¢ Avoid scratching ‚Äî it spreads irritation and risks infection\n‚Ä¢ Avoid potential triggers (new soaps, foods, plants)\n‚Ä¢ Calamine lotion soothes itching\n\n**See a doctor immediately if:**\n‚Ä¢ Rash is spreading rapidly or covers large areas\n‚Ä¢ Difficulty breathing or swallowing (anaphylaxis)\n‚Ä¢ Rash with fever, joint pain, or feeling very unwell\n‚Ä¢ Painful blisters\n‚Ä¢ Rash around the eyes or mouth\n‚Ä¢ You suspect meningitis (non-fading rash with stiff neck and fever)'
    },

    'chest': {
      response: '[EMERGENCY]\nüö® Chest pain or difficulty breathing can be a medical emergency.\n\n**Call emergency services (911) immediately if you have:**\n‚Ä¢ Crushing, pressure, or squeezing chest pain\n‚Ä¢ Pain spreading to left arm, jaw, back, or shoulder\n‚Ä¢ Shortness of breath\n‚Ä¢ Cold sweats, nausea, or lightheadedness with chest pain\n‚Ä¢ Sudden severe breathing difficulty\n\nThese could be signs of a **heart attack** or **pulmonary embolism** ‚Äî both are life-threatening emergencies.\n\n**Do not drive yourself. Call 911 or have someone take you to the ER immediately.**\n\n**Other possible causes (less urgent but still important):**\n‚Ä¢ Costochondritis (rib cartilage inflammation)\n‚Ä¢ Acid reflux/GERD\n‚Ä¢ Anxiety or panic attacks\n‚Ä¢ Pleurisy (inflammation of lung lining)\n‚Ä¢ Muscle strain\n\nEven if symptoms are mild, chest pain should always be evaluated by a medical professional.'
    },

    'cold': {
      response: '[INFO]\nColds and flu are very common, especially in winter months.\n\n**Cold vs Flu:**\n‚Ä¢ **Cold:** Gradual onset, runny nose, mild fatigue\n‚Ä¢ **Flu:** Sudden onset, high fever, severe body aches, extreme fatigue\n\n**Home care:**\n‚Ä¢ Rest ‚Äî your immune system does most of the work\n‚Ä¢ Stay hydrated (water, warm broths, herbal teas)\n‚Ä¢ Use saline nasal sprays or rinses for congestion\n‚Ä¢ Honey soothes coughs and sore throat\n‚Ä¢ Chicken soup really does help (reduces inflammation)\n‚Ä¢ Ibuprofen or acetaminophen for fever and aches\n‚Ä¢ Zinc lozenges within 24 hours of symptoms may shorten duration\n\n**Prevention:**\n‚Ä¢ Wash hands frequently\n‚Ä¢ Avoid touching face\n‚Ä¢ Get annual flu vaccine\n‚Ä¢ Maintain good nutrition and sleep\n\n**See a doctor if:**\n‚Ä¢ Symptoms are severe or getting worse after 7 days\n‚Ä¢ Difficulty breathing or chest pain\n‚Ä¢ High fever (above 103¬∞F) lasting more than 3 days\n‚Ä¢ Flu-like symptoms in high-risk individuals (elderly, pregnant, immunocompromised)'
    },

    'back pain': {
      response: '[INFO]\nBack pain is one of the most common health complaints worldwide.\n\n**Common causes:**\nMuscle strain, poor posture, herniated disc, arthritis, or sedentary lifestyle.\n\n**Home care for most back pain:**\n‚Ä¢ Stay active ‚Äî bed rest often makes it worse\n‚Ä¢ Apply ice for the first 48‚Äì72 hours, then switch to heat\n‚Ä¢ Over-the-counter pain relievers (ibuprofen or acetaminophen)\n‚Ä¢ Gentle stretching and movement\n‚Ä¢ Improve your posture and workstation ergonomics\n‚Ä¢ Sleep on a supportive mattress\n\n**Prevention:**\n‚Ä¢ Strengthen your core muscles\n‚Ä¢ Lift properly (bend knees, not back)\n‚Ä¢ Maintain healthy weight\n‚Ä¢ Take movement breaks if you sit for long periods\n\n**See a doctor if:**\n‚Ä¢ Pain follows an injury or accident\n‚Ä¢ Severe pain not improving with rest\n‚Ä¢ Pain radiating down your leg (sciatica)\n‚Ä¢ Numbness, tingling, or weakness in legs\n‚Ä¢ Loss of bladder or bowel control (emergency)'
    },

    'joint pain': {
      response: '[INFO]\nJoint pain can stem from many causes, from overuse to inflammatory conditions.\n\n**Common causes:**\nOsteoarthritis, rheumatoid arthritis, gout, injury, bursitis, or tendinitis.\n\n**Home care:**\n‚Ä¢ Rest the affected joint\n‚Ä¢ Ice for acute pain/swelling (20 min on, 20 off)\n‚Ä¢ Compression and elevation help reduce swelling\n‚Ä¢ Anti-inflammatory medication (ibuprofen, naproxen)\n‚Ä¢ Gentle movement and range-of-motion exercises when tolerated\n‚Ä¢ Maintain healthy weight to reduce joint stress\n\n**What helps long-term:**\n‚Ä¢ Low-impact exercise (swimming, cycling, walking)\n‚Ä¢ Physical therapy\n‚Ä¢ Anti-inflammatory diet (omega-3s, turmeric, vegetables)\n‚Ä¢ Supplements: Glucosamine and chondroitin may help\n\n**See a doctor if:**\n‚Ä¢ Severe swelling, redness, or warmth in a joint\n‚Ä¢ Sudden joint pain with fever\n‚Ä¢ Pain significantly limits daily activities\n‚Ä¢ Pain lasting more than a few weeks'
    }
  };

  // ‚îÄ‚îÄ‚îÄ CONVERSATION STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let messages = [];
  let isLoading = false;
  let hasGreeted = false;

  // ‚îÄ‚îÄ‚îÄ UTILITIES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function getTime() {
    return new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  }

  function autoResize(el) {
    el.style.height = 'auto';
    el.style.height = Math.min(el.scrollHeight, 140) + 'px';
  }

  function handleKey(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  }

  function escapeHTML(str) {
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  }

  // ‚îÄ‚îÄ‚îÄ RESPONSE FORMATTING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function formatAIResponse(text) {
    let tagClass = 'info';
    let tagLabel = '‚ÑπÔ∏è Health Info';

    if (text.startsWith('[EMERGENCY]')) {
      tagClass = 'emergency';
      tagLabel = 'üö® EMERGENCY';
      text = text.replace('[EMERGENCY]', '').trim();
    } else if (text.startsWith('[IMPORTANT]')) {
      tagClass = 'warning';
      tagLabel = '‚ö†Ô∏è Important';
      text = text.replace('[IMPORTANT]', '').trim();
    } else if (text.startsWith('[INFO]')) {
      tagClass = 'info';
      tagLabel = '‚ÑπÔ∏è Health Info';
      text = text.replace('[INFO]', '').trim();
    } else if (text.startsWith('[GREETING]')) {
      tagClass = 'greeting';
      tagLabel = 'üëã Hello!';
      text = text.replace('[GREETING]', '').trim();
    }

    const urgencyTag = `<div class="tag ${tagClass}">${tagLabel}</div>`;

    let html = escapeHTML(text)
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/\*(.*?)\*/g, '<em>$1</em>')
      .replace(/\n\n/g, '</p><p>')
      .replace(/\n‚Ä¢/g, '<br>‚Ä¢')
      .replace(/\n-\s/g, '<br>‚Ä¢ ')
      .replace(/\n(\d+)\.\s/g, '<br>$1. ')
      .replace(/\n/g, '<br>');

    return urgencyTag + '<p>' + html + '</p>';
  }

  // ‚îÄ‚îÄ‚îÄ MAIN RESPONSE LOGIC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function findResponse(userMessage) {
    const msg = userMessage.toLowerCase().trim();

    // 1. Check for greetings
    for (const pattern of greetingPatterns) {
      if (pattern.test(msg)) {
        // If the message also contains symptoms, greet then answer
        const symptoms = detectSymptoms(msg);
        if (symptoms.length > 0) {
          return buildGreetingPlusSymptomResponse(symptoms, msg);
        }
        return getGreetingResponse();
      }
    }

    // 2. Check for gratitude
    for (const pattern of gratitudePatterns) {
      if (pattern.test(msg) && msg.length < 80) {
        return getGratitudeResponse();
      }
    }

    // 3. Check for farewells
    for (const pattern of farewellPatterns) {
      if (pattern.test(msg) && msg.length < 60) {
        return getFarewellResponse();
      }
    }

    // 4. Check for "how are you"
    for (const pattern of howAreYouPatterns) {
      if (pattern.test(msg)) {
        return getHowAreYouResponse();
      }
    }

    // 5. Detect symptoms in sentence
    const detectedSymptoms = detectSymptoms(msg);
    if (detectedSymptoms.length > 0) {
      return buildSymptomResponse(detectedSymptoms, msg);
    }

    // 6. Fallback: check healthKnowledge keywords directly
    for (const [topic, data] of Object.entries(healthKnowledge)) {
      if (data.keywords) {
        for (const keyword of data.keywords) {
          if (msg.includes(keyword)) {
            return data.response;
          }
        }
      }
    }

    // 7. Default fallback
    return `[INFO]\nI appreciate your question! I'm designed to help with health-related topics. I can understand natural sentences like "I have a headache and feel dizzy" or "I'm feeling anxious and can't sleep."\n\n**Topics I can help with:**\n‚Ä¢ Fever, sore throat, headaches, coughs\n‚Ä¢ Anxiety, depression, stress, sleep issues\n‚Ä¢ Blood pressure, diabetes, dehydration\n‚Ä¢ Nutrition, hydration, vaccinations\n‚Ä¢ Chest pain, rashes, joint & back pain\n‚Ä¢ Nausea and stomach issues\n‚Ä¢ Colds, flu, and common infections\n\nTry describing how you feel in your own words, or use the sidebar to explore specific topics!`;
  }

  // Build a response for detected symptoms (with intro)
  function buildSymptomResponse(symptoms, originalMsg) {
    // Emergency check first
    const emergencyTopics = ['chest'];
    for (const s of symptoms) {
      if (emergencyTopics.includes(s.topic)) {
        return healthKnowledge['chest'].response;
      }
    }

    if (symptoms.length === 1) {
      const topic = symptoms[0].topic;
      const knowledge = healthKnowledge[topic];
      if (knowledge) {
        // Add a warm personal intro to single symptom
        const intros = [
          `I noticed you mentioned **${symptoms[0].keyword}**. Let me share what you should know:\n\n`,
          `I can see you're dealing with **${symptoms[0].keyword}**. Here's helpful guidance:\n\n`,
          `Thanks for describing how you're feeling. Regarding **${symptoms[0].keyword}**:\n\n`
        ];
        const intro = intros[Math.floor(Math.random() * intros.length)];
        return knowledge.response.replace(/^\[.*?\]\n/, match => match + intro);
      }
    }

    if (symptoms.length > 1) {
      // Multiple symptoms ‚Äî give combined response
      let combined = '[INFO]\nI detected **multiple symptoms** in your message. Let me address each one:\n\n';
      symptoms.forEach((s, i) => {
        const knowledge = healthKnowledge[s.topic];
        if (knowledge) {
          const clean = knowledge.response
            .replace(/^\[.*?\]\n/, '')  // remove tag
            .split('\n')[0];            // just the first line as preview
          combined += `**${i + 1}. ${s.keyword.charAt(0).toUpperCase() + s.keyword.slice(1)}:**\n${clean}\n\n`;
        }
      });

      // Add the most detailed response for the first detected symptom
      const primaryTopic = symptoms[0].topic;
      const primaryKnowledge = healthKnowledge[primaryTopic];
      if (primaryKnowledge) {
        combined += `---\n**Detailed info on your primary concern (${symptoms[0].keyword}):**\n\n`;
        combined += primaryKnowledge.response.replace(/^\[.*?\]\n/, '');
      }

      return combined;
    }

    return findResponse('');
  }

  // Build greeting + symptom combined response
  function buildGreetingPlusSymptomResponse(symptoms, msg) {
    const greetings = ['Hello! üëã', 'Hi there! üòä', 'Hey! ü©∫', 'Good to see you! üëã'];
    const greeting = greetings[Math.floor(Math.random() * greetings.length)];

    const symptomNames = symptoms.map(s => s.keyword).join(', ');
    const intro = `[INFO]\n${greeting} I noticed you mentioned **${symptomNames}** ‚Äî let me help with that right away!\n\n`;

    if (symptoms.length === 1) {
      const knowledge = healthKnowledge[symptoms[0].topic];
      if (knowledge) {
        return intro + knowledge.response.replace(/^\[.*?\]\n/, '');
      }
    }

    return intro + buildSymptomResponse(symptoms, msg).replace(/^\[.*?\]\n/, '');
  }

  // ‚îÄ‚îÄ‚îÄ UI FUNCTIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function appendMessage(role, content, isHTML = false) {
    const welcome = document.getElementById('welcomeScreen');
    if (welcome) welcome.remove();

    const container = document.getElementById('chatMessages');
    const row = document.createElement('div');
    row.className = `message-row ${role}`;

    const avatarEl = document.createElement('div');
    avatarEl.className = `avatar ${role}`;
    avatarEl.textContent = role === 'ai' ? '‚öïÔ∏è' : 'üë§';

    const bubbleEl = document.createElement('div');
    bubbleEl.className = `bubble ${role}`;

    if (isHTML) {
      bubbleEl.innerHTML = content;
    } else {
      bubbleEl.textContent = content;
    }

    const timeEl = document.createElement('div');
    timeEl.className = 'msg-time';
    timeEl.textContent = getTime();

    const colEl = document.createElement('div');
    colEl.appendChild(bubbleEl);
    colEl.appendChild(timeEl);

    if (role === 'user') {
      row.appendChild(colEl);
      row.appendChild(avatarEl);
    } else {
      row.appendChild(avatarEl);
      row.appendChild(colEl);
    }

    container.appendChild(row);
    container.scrollTop = container.scrollHeight;
  }

  function showTyping() {
    const container = document.getElementById('chatMessages');
    const row = document.createElement('div');
    row.className = 'message-row ai';
    row.id = 'typingRow';

    const avatar = document.createElement('div');
    avatar.className = 'avatar ai';
    avatar.textContent = '‚öïÔ∏è';

    const bubble = document.createElement('div');
    bubble.className = 'bubble ai';
    bubble.innerHTML = `<div class="typing-indicator">
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
    </div>`;

    row.appendChild(avatar);
    row.appendChild(bubble);
    container.appendChild(row);
    container.scrollTop = container.scrollHeight;
  }

  function removeTyping() {
    const t = document.getElementById('typingRow');
    if (t) t.remove();
  }

  async function sendMessage() {
    const input = document.getElementById('chatInput');
    const text = input.value.trim();
    if (!text || isLoading) return;

    input.value = '';
    input.style.height = 'auto';
    isLoading = true;
    document.getElementById('sendBtn').disabled = true;

    appendMessage('user', text);
    messages.push({ role: 'user', content: text });
    showTyping();

    const delay = 400 + Math.random() * 700;

    setTimeout(() => {
      removeTyping();
      const aiText = findResponse(text);
      messages.push({ role: 'assistant', content: aiText });
      appendMessage('ai', formatAIResponse(aiText), true);

      isLoading = false;
      document.getElementById('sendBtn').disabled = false;
      document.getElementById('chatInput').focus();
    }, delay);
  }

  function sendQuick(text) {
    document.getElementById('chatInput').value = text;
    sendMessage();
  }

  function clearChat() {
    messages = [];
    hasGreeted = false;
    const container = document.getElementById('chatMessages');
    container.innerHTML = `
      <div class="welcome" id="welcomeScreen">
        <div class="welcome-icon">ü©∫</div>
        <h2>Your AI Health Companion</h2>
        <p>Ask me anything about symptoms, medications, wellness, nutrition, or general health. You can even just describe how you feel in a sentence ‚Äî I'll detect the symptoms automatically!</p>
        <div class="welcome-chips">
          <div class="chip" onclick="sendQuick('Hi, I have a fever and sore throat, what should I do?')">ü§í Fever & sore throat</div>
          <div class="chip" onclick="sendQuick('What are common signs of anxiety?')">üò∞ Signs of anxiety</div>
          <div class="chip" onclick="sendQuick('How much water should I drink daily?')">üíß Daily water intake</div>
          <div class="chip" onclick="sendQuick('What vaccinations do adults need?')">üíâ Vaccinations</div>
          <div class="chip" onclick="sendQuick('Tips for managing stress naturally')">üßò Stress management</div>
          <div class="chip" onclick="sendQuick('How do I know if I need to see a doctor?')">üè• When to see a doctor</div>
        </div>
      </div>`;
  }

  function analyzeSymptom() {
    const symptom = document.getElementById('sc-symptom').value.trim().toLowerCase();
    const severity = document.getElementById('sc-severity').value;
    const duration = document.getElementById('sc-duration').value;
    const resultEl = document.getElementById('risk-result');

    if (!symptom || !severity || !duration) {
      resultEl.style.display = 'block';
      resultEl.innerHTML = '<p style="color:var(--red)">Please fill in all fields.</p>';
      return;
    }

    const emergencyKeywords = ['chest pain', 'heart attack', 'shortness of breath', 'difficulty breathing', 'stroke', 'unconscious', 'seizure', 'severe bleeding', "can't breathe", 'choking', 'poisoning'];
    const isEmergency = emergencyKeywords.some(k => symptom.includes(k));

    let riskLevel, riskClass, advice;

    if (isEmergency || (severity === 'Severe' && duration === 'Less than 1 day')) {
      riskLevel = 'üö® Emergency';
      riskClass = 'risk-emergency';
      advice = 'Call emergency services (911) immediately or go to the nearest emergency room.';
    } else if (severity === 'Severe' || (severity === 'Moderate' && duration === 'More than 1 week')) {
      riskLevel = '‚ö†Ô∏è High';
      riskClass = 'risk-warning';
      advice = 'Visit a healthcare provider as soon as possible.';
    } else if (severity === 'Moderate') {
      riskLevel = '‚ö†Ô∏è Moderate';
      riskClass = 'risk-warning';
      advice = 'Monitor closely. See a doctor if symptoms worsen or persist.';
    } else {
      riskLevel = '‚úÖ Low';
      riskClass = 'risk-safe';
      advice = 'Rest, stay hydrated, and monitor symptoms. Consult a doctor if no improvement.';
    }

    resultEl.style.display = 'block';
    resultEl.innerHTML = `
      <p><strong class="${riskClass}">Risk: ${riskLevel}</strong></p>
      <p style="color:var(--text-muted);margin-top:4px">${advice}</p>
    `;

    const msg = `I have ${symptom}. Severity: ${severity}. Duration: ${duration}. What should I know?`;
    sendQuick(msg);
  }
</script>
</body>
</html>
