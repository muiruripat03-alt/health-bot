<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>MedPro AI ‚Äî Health Assistant</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet"/>
<style>
  :root {
    --bg: #0a0f1e;
    --surface: #111827;
    --surface2: #1a2236;
    --border: #1f2f4a;
    --accent: #00d4a8;
    --accent2: #0088ff;
    --accent3: #7c3aed;
    --text: #e8f0fe;
    --text-muted: #6b7fa3;
    --user-bubble: #0f3460;
    --ai-bubble: #141f35;
    --red: #ff4f6a;
    --yellow: #f59e0b;
    --green: #10b981;
    --radius: 16px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Sora', sans-serif;
    background: var(--bg);
    color: var(--text);
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* Animated background */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 80% 50% at 20% 10%, rgba(0,212,168,0.06) 0%, transparent 60%),
      radial-gradient(ellipse 60% 40% at 80% 80%, rgba(0,136,255,0.07) 0%, transparent 60%),
      radial-gradient(ellipse 50% 50% at 50% 50%, rgba(124,58,237,0.04) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  /* Header */
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 24px;
    border-bottom: 1px solid var(--border);
    background: rgba(17,24,39,0.8);
    backdrop-filter: blur(20px);
    position: relative;
    z-index: 10;
    flex-shrink: 0;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .logo-icon {
    width: 40px; height: 40px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
    box-shadow: 0 0 20px rgba(0,212,168,0.3);
  }

  .logo-text {
    display: flex; flex-direction: column;
  }

  .logo-text strong {
    font-family: 'DM Serif Display', serif;
    font-size: 18px;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1;
  }

  .logo-text span {
    font-size: 11px;
    color: var(--text-muted);
    letter-spacing: 0.05em;
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .status-badge {
    display: flex; align-items: center; gap: 6px;
    padding: 6px 12px;
    background: rgba(16,185,129,0.1);
    border: 1px solid rgba(16,185,129,0.2);
    border-radius: 20px;
    font-size: 12px;
    color: var(--green);
  }

  .status-dot {
    width: 7px; height: 7px;
    background: var(--green);
    border-radius: 50%;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(0.8); }
  }

  .btn-clear {
    padding: 7px 14px;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text-muted);
    font-size: 12px;
    font-family: 'Sora', sans-serif;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-clear:hover {
    border-color: var(--red);
    color: var(--red);
  }

  /* Main layout */
  .main {
    display: flex;
    flex: 1;
    overflow: hidden;
    position: relative;
    z-index: 1;
  }

  /* Sidebar */
  .sidebar {
    width: 280px;
    flex-shrink: 0;
    background: rgba(17,24,39,0.6);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    padding: 20px 16px;
    gap: 20px;
  }

  .sidebar-section h4 {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--text-muted);
    margin-bottom: 10px;
    font-weight: 600;
  }

  .quick-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
    padding: 10px 12px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--text);
    font-size: 13px;
    font-family: 'Sora', sans-serif;
    cursor: pointer;
    text-align: left;
    transition: all 0.2s;
    margin-bottom: 6px;
  }

  .quick-btn:hover {
    border-color: var(--accent);
    background: rgba(0,212,168,0.05);
    color: var(--accent);
    transform: translateX(3px);
  }

  .quick-btn .icon { font-size: 16px; }

  /* Symptom checker panel */
  .checker-panel {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px;
  }

  .checker-panel h4 {
    font-size: 13px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 10px;
    display: flex; align-items: center; gap: 6px;
  }

  .form-group { margin-bottom: 10px; }

  .form-group label {
    font-size: 11px;
    color: var(--text-muted);
    display: block;
    margin-bottom: 4px;
  }

  .form-control {
    width: 100%;
    padding: 8px 10px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'Sora', sans-serif;
    font-size: 12px;
    outline: none;
    transition: border-color 0.2s;
  }

  .form-control:focus { border-color: var(--accent); }
  .form-control option { background: var(--surface); }

  .btn-analyze {
    width: 100%;
    padding: 9px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border: none;
    border-radius: 8px;
    color: #000;
    font-family: 'Sora', sans-serif;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    margin-top: 4px;
  }

  .btn-analyze:hover { opacity: 0.9; transform: translateY(-1px); }

  .risk-result {
    margin-top: 10px;
    padding: 10px;
    background: var(--bg);
    border-radius: 8px;
    font-size: 12px;
    display: none;
    animation: fadeIn 0.3s ease;
  }

  .risk-result p { margin-bottom: 4px; line-height: 1.5; }

  .risk-emergency { color: var(--red); font-weight: 600; }
  .risk-warning { color: var(--yellow); font-weight: 600; }
  .risk-safe { color: var(--green); font-weight: 600; }

  /* Disclaimer */
  .disclaimer {
    font-size: 10px;
    color: var(--text-muted);
    background: rgba(245,158,11,0.05);
    border: 1px solid rgba(245,158,11,0.15);
    border-radius: 8px;
    padding: 8px 10px;
    line-height: 1.5;
  }

  /* Chat area */
  .chat-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 24px 28px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    scroll-behavior: smooth;
  }

  .chat-messages::-webkit-scrollbar { width: 4px; }
  .chat-messages::-webkit-scrollbar-track { background: transparent; }
  .chat-messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

  /* Welcome */
  .welcome {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px;
    text-align: center;
    animation: fadeIn 0.6s ease;
  }

  .welcome-icon {
    width: 80px; height: 80px;
    background: linear-gradient(135deg, rgba(0,212,168,0.15), rgba(0,136,255,0.15));
    border: 1px solid rgba(0,212,168,0.2);
    border-radius: 24px;
    display: flex; align-items: center; justify-content: center;
    font-size: 40px;
    margin-bottom: 20px;
    box-shadow: 0 0 40px rgba(0,212,168,0.1);
  }

  .welcome h2 {
    font-family: 'DM Serif Display', serif;
    font-size: 28px;
    background: linear-gradient(135deg, var(--text), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 10px;
  }

  .welcome p {
    color: var(--text-muted);
    font-size: 14px;
    max-width: 400px;
    line-height: 1.7;
    margin-bottom: 24px;
  }

  .welcome-chips {
    display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
  }

  .chip {
    padding: 8px 16px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 20px;
    font-size: 12px;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.2s;
  }

  .chip:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(0,212,168,0.05);
  }

  /* Messages */
  .message-row {
    display: flex;
    gap: 12px;
    animation: slideUp 0.3s ease;
  }

  .message-row.user { flex-direction: row-reverse; }

  @keyframes slideUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .avatar {
    width: 34px; height: 34px;
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px;
    flex-shrink: 0;
    margin-top: 2px;
  }

  .avatar.ai {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    box-shadow: 0 0 12px rgba(0,212,168,0.3);
  }

  .avatar.user {
    background: var(--user-bubble);
    border: 1px solid var(--border);
  }

  .bubble {
    max-width: 68%;
    padding: 13px 16px;
    border-radius: 14px;
    font-size: 14px;
    line-height: 1.65;
  }

  .bubble.ai {
    background: var(--ai-bubble);
    border: 1px solid var(--border);
    border-top-left-radius: 4px;
    color: var(--text);
  }

  .bubble.user {
    background: var(--user-bubble);
    border: 1px solid rgba(0,136,255,0.2);
    border-top-right-radius: 4px;
    color: var(--text);
  }

  .bubble a { color: var(--accent); }

  .bubble .tag {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    margin-bottom: 6px;
  }

  .tag.emergency { background: rgba(255,79,106,0.15); color: var(--red); border: 1px solid rgba(255,79,106,0.3); }
  .tag.warning { background: rgba(245,158,11,0.15); color: var(--yellow); border: 1px solid rgba(245,158,11,0.3); }
  .tag.info { background: rgba(0,212,168,0.1); color: var(--accent); border: 1px solid rgba(0,212,168,0.2); }

  .msg-time {
    font-size: 10px;
    color: var(--text-muted);
    margin-top: 4px;
    padding: 0 4px;
  }

  /* Typing indicator */
  .typing-indicator {
    display: flex; align-items: center; gap: 5px;
    padding: 14px 16px;
  }

  .typing-dot {
    width: 7px; height: 7px;
    background: var(--accent);
    border-radius: 50%;
    animation: typing 1.2s infinite;
  }

  .typing-dot:nth-child(2) { animation-delay: 0.2s; }
  .typing-dot:nth-child(3) { animation-delay: 0.4s; }

  @keyframes typing {
    0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
    30% { transform: translateY(-6px); opacity: 1; }
  }

  /* Input area */
  .input-area {
    padding: 16px 24px 20px;
    border-top: 1px solid var(--border);
    background: rgba(17,24,39,0.8);
    backdrop-filter: blur(20px);
    flex-shrink: 0;
  }

  .input-row {
    display: flex;
    gap: 10px;
    align-items: flex-end;
    max-width: 800px;
    margin: 0 auto;
  }

  .input-wrapper {
    flex: 1;
    position: relative;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 14px;
    transition: border-color 0.2s;
  }

  .input-wrapper:focus-within {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(0,212,168,0.08);
  }

  #chatInput {
    width: 100%;
    background: transparent;
    border: none;
    outline: none;
    color: var(--text);
    font-family: 'Sora', sans-serif;
    font-size: 14px;
    padding: 13px 16px;
    resize: none;
    max-height: 140px;
    line-height: 1.5;
  }

  #chatInput::placeholder { color: var(--text-muted); }

  .input-hint {
    font-size: 11px;
    color: var(--text-muted);
    text-align: center;
    margin-top: 8px;
  }

  .send-btn {
    width: 46px; height: 46px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border: none;
    border-radius: 12px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    transition: all 0.2s;
    flex-shrink: 0;
    box-shadow: 0 4px 15px rgba(0,212,168,0.25);
  }

  .send-btn:hover { transform: scale(1.05); box-shadow: 0 6px 20px rgba(0,212,168,0.35); }
  .send-btn:active { transform: scale(0.97); }
  .send-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  /* Responsive */
  @media (max-width: 768px) {
    .sidebar { display: none; }
    .chat-messages { padding: 16px; }
    .bubble { max-width: 85%; }
  }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="logo">
    <div class="logo-icon">‚öïÔ∏è</div>
    <div class="logo-text">
      <strong>MedPro AI</strong>
      <span>Health Assistant</span>
    </div>
  </div>
  <div class="header-right">
    <div class="status-badge">
      <div class="status-dot"></div>
      AI Online
    </div>
    <button class="btn-clear" onclick="clearChat()">Clear Chat</button>
  </div>
</div>

<!-- Main -->
<div class="main">

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-section">
      <h4>Quick Topics</h4>
      <button class="quick-btn" onclick="sendQuick('What are symptoms of high blood pressure?')">
        <span class="icon">‚ù§Ô∏è</span> Blood Pressure
      </button>
      <button class="quick-btn" onclick="sendQuick('How do I manage diabetes?')">
        <span class="icon">ü©∏</span> Diabetes
      </button>
      <button class="quick-btn" onclick="sendQuick('What causes persistent headaches?')">
        <span class="icon">üß†</span> Headaches
      </button>
      <button class="quick-btn" onclick="sendQuick('Tips for better sleep and mental health')">
        <span class="icon">üò¥</span> Sleep & Mental Health
      </button>
      <button class="quick-btn" onclick="sendQuick('How to boost my immune system naturally?')">
        <span class="icon">üõ°Ô∏è</span> Immunity
      </button>
      <button class="quick-btn" onclick="sendQuick('What are signs of dehydration?')">
        <span class="icon">üíß</span> Dehydration
      </button>
      <button class="quick-btn" onclick="sendQuick('Healthy diet and nutrition tips')">
        <span class="icon">ü•ó</span> Nutrition
      </button>
      <button class="quick-btn" onclick="sendQuick('What vaccinations do adults need?')">
        <span class="icon">üíâ</span> Vaccines
      </button>
    </div>

    <!-- Symptom Checker -->
    <div class="sidebar-section">
      <h4>Quick Symptom Check</h4>
      <div class="checker-panel">
        <div class="form-group">
          <label>Main Symptom</label>
          <input class="form-control" id="sc-symptom" placeholder="e.g. chest pain, fever‚Ä¶"/>
        </div>
        <div class="form-group">
          <label>Severity</label>
          <select class="form-control" id="sc-severity">
            <option value="">Select‚Ä¶</option>
            <option>Mild</option>
            <option>Moderate</option>
            <option>Severe</option>
          </select>
        </div>
        <div class="form-group">
          <label>Duration</label>
          <select class="form-control" id="sc-duration">
            <option value="">Select‚Ä¶</option>
            <option>Less than 1 day</option>
            <option>1‚Äì3 days</option>
            <option>4‚Äì7 days</option>
            <option>More than 1 week</option>
          </select>
        </div>
        <button class="btn-analyze" onclick="analyzeSymptom()">Analyze Symptom</button>
        <div class="risk-result" id="risk-result"></div>
      </div>
    </div>

    <div class="disclaimer">
      ‚ö†Ô∏è MedPro AI provides general health information only. It is not a substitute for professional medical advice, diagnosis, or treatment. Always consult a qualified healthcare provider.
    </div>
  </div>

  <!-- Chat area -->
  <div class="chat-area">
    <div class="chat-messages" id="chatMessages">
      <div class="welcome" id="welcomeScreen">
        <div class="welcome-icon">ü©∫</div>
        <h2>Your AI Health Companion</h2>
        <p>Ask me anything about symptoms, medications, wellness, nutrition, or general health. I'm here to help you understand your health better.</p>
        <div class="welcome-chips">
          <div class="chip" onclick="sendQuick('I have a fever and sore throat, what should I do?')">ü§í Fever & sore throat</div>
          <div class="chip" onclick="sendQuick('What are common signs of anxiety?')">üò∞ Signs of anxiety</div>
          <div class="chip" onclick="sendQuick('How much water should I drink daily?')">üíß Daily water intake</div>
          <div class="chip" onclick="sendQuick('What foods are good for heart health?')">ü´Ä Heart-healthy foods</div>
          <div class="chip" onclick="sendQuick('How do I know if I need to see a doctor?')">üè• When to see a doctor</div>
          <div class="chip" onclick="sendQuick('Tips for managing stress and anxiety naturally')">üßò Stress management</div>
        </div>
      </div>
    </div>

    <div class="input-area">
      <div class="input-row">
        <div class="input-wrapper">
          <textarea id="chatInput" rows="1" placeholder="Ask about symptoms, medications, wellness‚Ä¶" onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
        </div>
        <button class="send-btn" id="sendBtn" onclick="sendMessage()">‚û§</button>
      </div>
      <div class="input-hint">Press Enter to send ¬∑ Shift+Enter for new line</div>
    </div>
  </div>

</div>

<script>
  const SYSTEM_PROMPT = `You are MedPro AI, a knowledgeable and empathetic health assistant. You provide accurate, helpful general health information.

Guidelines:
- Provide clear, evidence-based health information in a warm, professional tone
- Always remind users to consult a qualified healthcare professional for diagnosis, treatment decisions, or emergencies
- If someone describes emergency symptoms (chest pain, difficulty breathing, stroke symptoms, severe bleeding, etc.), URGENTLY direct them to call emergency services (911 or local equivalent) FIRST before any other advice
- Format responses clearly with short paragraphs. Use bullet points sparingly and only when listing multiple items
- Never diagnose conditions. You can explain what symptoms might indicate and what questions a doctor might ask
- Be empathetic and supportive, especially for mental health topics
- Keep responses concise but thorough ‚Äî aim for 3‚Äì5 paragraphs max unless detail is truly needed
- Start your response with a brief empathetic acknowledgment when the user describes personal symptoms
- If asked about medications, explain general information but always say dosage should be confirmed with a pharmacist or doctor
- Tag your response urgency at the very start with one of: [EMERGENCY], [IMPORTANT], or [INFO] on its own line ‚Äî this helps the UI style the message appropriately. Only use [EMERGENCY] for life-threatening situations.`;

  let messages = [];
  let isLoading = false;

  function getTime() {
    return new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  }

  function autoResize(el) {
    el.style.height = 'auto';
    el.style.height = Math.min(el.scrollHeight, 140) + 'px';
  }

  function handleKey(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  }

  function escapeHTML(str) {
    return str.replace(/[&<>"']/g, m =>
      ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m])
    );
  }

  function formatAIResponse(text) {
    // Extract urgency tag
    let urgencyTag = '';
    let tagClass = 'info';
    let tagLabel = 'Health Info';

    if (text.startsWith('[EMERGENCY]')) {
      tagClass = 'emergency';
      tagLabel = 'üö® EMERGENCY';
      text = text.replace('[EMERGENCY]', '').trim();
    } else if (text.startsWith('[IMPORTANT]')) {
      tagClass = 'warning';
      tagLabel = '‚ö†Ô∏è Important';
      text = text.replace('[IMPORTANT]', '').trim();
    } else if (text.startsWith('[INFO]')) {
      tagClass = 'info';
      tagLabel = '‚ÑπÔ∏è Health Info';
      text = text.replace('[INFO]', '').trim();
    }

    urgencyTag = `<div class="tag ${tagClass}">${tagLabel}</div>`;

    // Format markdown-ish content
    let html = escapeHTML(text)
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/\*(.*?)\*/g, '<em>$1</em>')
      .replace(/\n\n/g, '</p><p>')
      .replace(/\n- /g, '<br>‚Ä¢ ')
      .replace(/\n(\d+)\. /g, '<br>$1. ')
      .replace(/\n/g, '<br>');

    return urgencyTag + '<p>' + html + '</p>';
  }

  function appendMessage(role, content, isHTML = false) {
    const welcome = document.getElementById('welcomeScreen');
    if (welcome) welcome.remove();

    const container = document.getElementById('chatMessages');
    const row = document.createElement('div');
    row.className = `message-row ${role}`;

    const avatarEl = document.createElement('div');
    avatarEl.className = `avatar ${role}`;
    avatarEl.textContent = role === 'ai' ? '‚öï' : 'üë§';

    const bubbleEl = document.createElement('div');
    bubbleEl.className = `bubble ${role}`;

    const msgWrap = document.createElement('div');
    if (isHTML) {
      bubbleEl.innerHTML = content;
    } else {
      bubbleEl.textContent = content;
    }

    const timeEl = document.createElement('div');
    timeEl.className = 'msg-time';
    timeEl.textContent = getTime();

    const colEl = document.createElement('div');
    colEl.appendChild(bubbleEl);
    colEl.appendChild(timeEl);

    if (role === 'user') {
      row.appendChild(colEl);
      row.appendChild(avatarEl);
    } else {
      row.appendChild(avatarEl);
      row.appendChild(colEl);
    }

    container.appendChild(row);
    container.scrollTop = container.scrollHeight;
    return bubbleEl;
  }

  function showTyping() {
    const container = document.getElementById('chatMessages');
    const row = document.createElement('div');
    row.className = 'message-row ai';
    row.id = 'typingRow';

    const avatar = document.createElement('div');
    avatar.className = 'avatar ai';
    avatar.textContent = '‚öï';

    const bubble = document.createElement('div');
    bubble.className = 'bubble ai';
    bubble.innerHTML = `<div class="typing-indicator">
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
    </div>`;

    row.appendChild(avatar);
    row.appendChild(bubble);
    container.appendChild(row);
    container.scrollTop = container.scrollHeight;
  }

  function removeTyping() {
    const t = document.getElementById('typingRow');
    if (t) t.remove();
  }

  async function sendMessage() {
    const input = document.getElementById('chatInput');
    const text = input.value.trim();
    if (!text || isLoading) return;

    input.value = '';
    input.style.height = 'auto';
    isLoading = true;
    document.getElementById('sendBtn').disabled = true;

    appendMessage('user', text);
    messages.push({ role: 'user', content: text });
    showTyping();

    try {
      const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 1000,
          system: SYSTEM_PROMPT,
          messages: messages
        })
      });

      const data = await response.json();
      removeTyping();

      const aiText = data.content && data.content[0] ? data.content[0].text : "I'm sorry, I couldn't process that. Please try again.";
      messages.push({ role: 'assistant', content: aiText });
      appendMessage('ai', formatAIResponse(aiText), true);

    } catch (err) {
      removeTyping();
      appendMessage('ai', formatAIResponse('[INFO]\nI\'m having trouble connecting right now. Please check your connection and try again.'), true);
      console.error(err);
    }

    isLoading = false;
    document.getElementById('sendBtn').disabled = false;
    document.getElementById('chatInput').focus();
  }

  function sendQuick(text) {
    document.getElementById('chatInput').value = text;
    sendMessage();
  }

  function clearChat() {
    messages = [];
    const container = document.getElementById('chatMessages');
    container.innerHTML = `
      <div class="welcome" id="welcomeScreen">
        <div class="welcome-icon">ü©∫</div>
        <h2>Your AI Health Companion</h2>
        <p>Ask me anything about symptoms, medications, wellness, nutrition, or general health. I'm here to help you understand your health better.</p>
        <div class="welcome-chips">
          <div class="chip" onclick="sendQuick('I have a fever and sore throat, what should I do?')">ü§í Fever & sore throat</div>
          <div class="chip" onclick="sendQuick('What are common signs of anxiety?')">üò∞ Signs of anxiety</div>
          <div class="chip" onclick="sendQuick('How much water should I drink daily?')">üíß Daily water intake</div>
          <div class="chip" onclick="sendQuick('What foods are good for heart health?')">ü´Ä Heart-healthy foods</div>
          <div class="chip" onclick="sendQuick('How do I know if I need to see a doctor?')">üè• When to see a doctor</div>
          <div class="chip" onclick="sendQuick('Tips for managing stress and anxiety naturally')">üßò Stress management</div>
        </div>
      </div>`;
  }

  // Symptom checker
  function analyzeSymptom() {
    const symptom = document.getElementById('sc-symptom').value.trim().toLowerCase();
    const severity = document.getElementById('sc-severity').value;
    const duration = document.getElementById('sc-duration').value;
    const resultEl = document.getElementById('risk-result');

    if (!symptom || !severity || !duration) {
      resultEl.style.display = 'block';
      resultEl.innerHTML = '<p style="color:var(--red)">Please fill in all fields.</p>';
      return;
    }

    const emergencyKeywords = ['chest pain', 'heart attack', 'shortness of breath', 'stroke', 'unconscious', 'seizure', 'severe bleeding', 'can\'t breathe'];
    const isEmergency = emergencyKeywords.some(k => symptom.includes(k));

    let riskLevel, riskClass, advice;

    if (isEmergency || (severity === 'Severe' && duration === 'Less than 1 day')) {
      riskLevel = 'üö® Emergency';
      riskClass = 'risk-emergency';
      advice = 'Call emergency services (911) immediately or go to the nearest emergency room.';
    } else if (severity === 'Severe' || (severity === 'Moderate' && duration === 'More than 1 week')) {
      riskLevel = '‚ö†Ô∏è High';
      riskClass = 'risk-warning';
      advice = 'Visit a healthcare provider as soon as possible.';
    } else if (severity === 'Moderate') {
      riskLevel = '‚ö†Ô∏è Moderate';
      riskClass = 'risk-warning';
      advice = 'Monitor closely. See a doctor if symptoms worsen or persist.';
    } else {
      riskLevel = '‚úÖ Low';
      riskClass = 'risk-safe';
      advice = 'Rest, stay hydrated, and monitor symptoms. Consult a doctor if no improvement.';
    }

    resultEl.style.display = 'block';
    resultEl.innerHTML = `
      <p><strong class="${riskClass}">Risk: ${riskLevel}</strong></p>
      <p style="color:var(--text-muted);margin-top:4px">${advice}</p>
    `;

    // Also send to chat for AI analysis
    const msg = `I have ${symptom}. Severity: ${severity}. Duration: ${duration}. What should I know?`;
    sendQuick(msg);
  }
</script>
</body>
</html>
